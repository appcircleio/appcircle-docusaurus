---
title: GCP Cloud Storage Configuration
description: Learn how to configure GCP Cloud Storage as object storage for Appcircle server when installing using a Helm chart
tags:
  [
    self-hosted,
    gcp,
    cloud-storage
  ]
sidebar_position: 50
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import NeedHelp from '@site/docs/_need-help.mdx';

## Overview

This guide provides comprehensive instructions for configuring Google Cloud Storage (GCS) as your object storage backend for the Appcircle server. While the default Helm chart deployment includes MinIO as an in-cluster object storage solution, **production environments** benefit from using a more robust and scalable solution like Google Cloud Storage.


:::caution
GCP Cloud Storage configuration requires a **fresh installation** of Appcircle Server. If you have an existing installation with data, migration from MinIO to GCP Cloud Storage is **not supported**. You can only configure GCP Cloud Storage during the initial installation or if you have no existing data to preserve.
:::

## Prerequisites

To complete this guide, you must have the following:

### 1. GCP Account and Permissions

A **Google Cloud Platform (GCP) account** with appropriate permissions to create and manage Cloud Storage buckets, IAM service accounts, and roles.

<details>
    <summary>Click to view more details about GCP permissions.</summary>

You need the following GCP permissions to complete this configuration:

- **Cloud Storage permissions**: Create buckets, configure CORS, manage bucket policies
- **IAM permissions**: Create service accounts, roles, and manage IAM bindings
- **Project permissions**: Access to the GCP project where resources will be created

If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.

</details>

### 2. Google Cloud SDK

The **Google Cloud SDK** is **required** and must be **[installed](https://cloud.google.com/sdk/docs/install)** and **[configured](https://cloud.google.com/sdk/docs/authorizing)** on your machine.

<details>
    <summary>Click to view more details about Google Cloud SDK configuration.</summary>

To configure Google Cloud SDK, you need:
```bash
gcloud init
```

Or by setting environment variables:
```bash
export GOOGLE_CLOUD_PROJECT="your-project-id"
export GOOGLE_APPLICATION_CREDENTIALS="path/to/service-account-key.json"
```

</details>

### 3. Kubernetes/OpenShift Access

**`kubectl`** (for Kubernetes) or **`oc`** (for OpenShift) CLI is **required** and must be configured to access your cluster.

### 4. Basic Understanding

Basic understanding of **GCP IAM**, **Cloud Storage**, and **Kubernetes/OpenShift** concepts is recommended.

:::info
This guide assumes you have administrative access to your GCP project and Kubernetes/OpenShift cluster. If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.
:::

## Configuration Steps

### 1. Set Up Environment Variables

**Set up your environment variables** before proceeding with the configuration. These variables will be used throughout the configuration process.

:::note
In this documentation, we will use `spacetech` as an **example organization name** and `us-east1` as an **example GCP region**. You should **replace these values** with your actual organization name and preferred GCP region.
:::

```bash
# Set your organization name and GCP project details
ORG_NAME="spacetech" # Replace with your organization name
PROJECT_ID="my-gcp-project" # Replace with your actual GCP project ID
BUCKET_PREFIX="appcircle-${ORG_NAME}"
LOCATION="us-east1" # Replace with your preferred GCP region
SERVICE_ACCOUNT_NAME="appcircle-server"
```

:::caution
- Replace `spacetech` with your organization name in the `ORG_NAME` variable
- Replace `my-gcp-project` with your actual GCP project ID in the `PROJECT_ID` variable
- Replace `us-east1` with your preferred GCP region in the `LOCATION` variable
- Ensure your organization name follows GCS naming conventions:
  - 3-63 characters long
  - Lowercase letters, numbers, dots (.), and hyphens (-)
  - Must start and end with a letter or number
  - Must be DNS-compliant
:::

### 2. Create GCP Cloud Storage Buckets

**Create the required GCS buckets** to store the artifacts generated by the Appcircle server.

Appcircle server requires the following GCS buckets for different purposes:

- **`${BUCKET_PREFIX}-temp`**: Temporary files and uploads
- **`${BUCKET_PREFIX}-build`**: Build artifacts and logs
- **`${BUCKET_PREFIX}-distribution`**: Testing Distribution files
- **`${BUCKET_PREFIX}-storesubmit`**: Appcircle Store Submit files
- **`${BUCKET_PREFIX}-store`**: Enterprise App Store files
- **`${BUCKET_PREFIX}-agent-cache`**: Appcircle Runner cache files
- **`${BUCKET_PREFIX}-backup`**: Backup files
- **`${BUCKET_PREFIX}-publish`**: Published mobile app binaries

Run the following commands to create all required buckets:

```bash
# Create all required buckets
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-temp/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-build/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-distribution/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-storesubmit/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-store/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-agent-cache/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-backup/
gsutil mb -l ${LOCATION} gs://${BUCKET_PREFIX}-publish/
```

:::info
The bucket names use your organization name to ensure global uniqueness, as GCS bucket names must be unique across all GCP projects worldwide.
:::

### 3. Configure CORS Settings

**Configure CORS settings** for the `temp` bucket to allow cross-origin requests from your Appcircle Server web UI.

:::caution
Replace `my.appcircle.spacetech.com` with your actual Appcircle Server web UI domain.
:::

- Create a CORS configuration file:

```bash
cat << 'EOF' > appcircle-gcs-policy.json
[
  {
    "origin": ["https://my.appcircle.spacetech.com"],
    "method": ["GET", "PUT", "POST", "DELETE", "HEAD"],
    "responseHeader": ["*"],
    "maxAgeSeconds": 3600
  }
]
EOF
```

- Apply the CORS configuration:

```bash
gsutil cors set appcircle-gcs-policy.json gs://${BUCKET_PREFIX}-temp
```

:::tip
- The CORS configuration is only required for the `temp` bucket
- Other buckets don't require CORS configuration as they are accessed server-side
- If you're using HTTP instead of HTTPS, replace `https://` with `http://` in the origin
:::

### 4. Create Service Account and Permissions

**Create a service account** with appropriate permissions for Appcircle Server to access the GCS buckets.

- **Create a service account** for Appcircle Server to access the GCS buckets.

```bash
gcloud iam service-accounts create ${SERVICE_ACCOUNT_NAME} \
  --description="AppCircle GCS access service account" \
  --display-name="AppCircle Server"
```

- **Create a custom role** with granular access for better security:

```bash
gcloud iam roles create AppcircleGCSRole \
  --project=$PROJECT_ID \
  --title="Appcircle GCS Role" \
  --description="For Appcircle Server to access GCS buckets" \
  --permissions="storage.objects.get,storage.objects.list,storage.objects.create,storage.objects.delete" \
  --stage=GA
```

**Bind the role to the service account** for each bucket:

```bash
# Bind permissions to each bucket
gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-temp \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-build \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-distribution \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-storesubmit \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-store \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-agent-cache \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-backup \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"

gcloud storage buckets add-iam-policy-binding gs://${BUCKET_PREFIX}-publish \
  --member="serviceAccount:${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="projects/${PROJECT_ID}/roles/AppcircleGCSRole"
```



### 5. Generate Service Account Credentials

**Generate and download credentials** for the service account:

```bash
gcloud iam service-accounts keys create appcircle-sa-key.json \
  --iam-account=${SERVICE_ACCOUNT_NAME}@${PROJECT_ID}.iam.gserviceaccount.com
```

**Save the `appcircle-sa-key.json` file securely**. This file contains the credentials that Appcircle Server will use to access the GCS buckets.


## Create Kubernetes Secret

**Create a Kubernetes secret** with the GCP credentials to be used by Appcircle Server.

<Tabs groupId="Platform">

  <TabItem value="kubernetes" label="Kubernetes">

```bash
# Convert the service account key to base64
ENCODED_CREDENTIALS=$(cat appcircle-sa-key.json | base64 -w 0)

# Create the Kubernetes secret
kubectl create secret generic gcs-credentials \
  -n appcircle \
  --from-literal=gcs-credentials-base64="${ENCODED_CREDENTIALS}"
```

  </TabItem>
  <TabItem value="openshift" label="OpenShift">

```bash
# Convert the service account key to base64
ENCODED_CREDENTIALS=$(cat appcircle-sa-key.json | base64 -w 0)

# Create the OpenShift secret
oc create secret generic appcircle-gcs-credentials \
  -n appcircle \
  --from-literal=gcs-credentials-base64="${ENCODED_CREDENTIALS}"
```

  </TabItem>
</Tabs>

:::caution
- Replace `appcircle` with the actual namespace/project where Appcircle Server will be installed
- Ensure the `appcircle-sa-key.json` file is in your current directory
- The secret name `appcircle-gcs-credentials` will be referenced in the Helm configuration
:::

## Configure Helm Values

**Configure your `values.yaml` file** to use GCP Cloud Storage instead of MinIO.

Add or update the following configuration to your `values.yaml` file:

```yaml
global:
  minio:
    url: https://storage.googleapis.com # Replace with your GCS endpoint
    region: "us-east1" # Replace with your GCP region
    useHttp: "false" # Set to "false" if you're using HTTPS GCS endpoint
    bucketPrefix: "appcircle-spacetech-" # Replace with your bucket prefix
resource:
  s3:
    clientProvider: "GCLOUD" # Set to "GCLOUD" to use GCP Cloud Storage
    cdnProvider: ""
    googleCredentialsSecretName: appcircle-gcs-credentials # Reference to the secret created above
minio:
  enabled: false # Disable internal MinIO deployment
```

:::caution
- Do not change the `https://storage.googleapis.com` value. It is set to the default GCS endpoint.
- Replace `us-east1` with your GCP region
- Replace `appcircle-spacetech-` with your actual bucket prefix
- Set `useHttp` to `true` only if you're using HTTP instead of HTTPS (not recommended for production)
- Ensure `googleCredentialsSecretName` matches the secret name created in the previous step
:::

## Next Steps

After completing the GCP Cloud Storage configuration:

1. **Return to the main installation guide**:
   - For Kubernetes: [Kubernetes Installation](/self-hosted-appcircle/install-server/helm-chart/installation/kubernetes)
   - For OpenShift: [OpenShift Installation](/self-hosted-appcircle/install-server/helm-chart/installation/openshift)

2. **Continue with the installation process** using your configured `values.yaml` file

3. **Verify the configuration** by checking that Appcircle Server can access the GCS buckets after installation

<NeedHelp />
