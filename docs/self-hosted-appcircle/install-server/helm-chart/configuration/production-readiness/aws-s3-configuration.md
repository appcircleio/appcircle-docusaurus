---
title: AWS S3 Configuration
description: Learn how to configure AWS S3 as object storage for Appcircle server when installing using a Helm chart
tags:
  [
    self-hosted,
    aws,
    minio
  ]
sidebar_position: 40
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import NeedHelp from '@site/docs/\_need-help.mdx';

## Overview

Appcircle server requires object storage to store various artifacts, including build logs and application binaries. By default, the Helm chart deploys MinIO as an in-cluster object storage solution. However, for production environments, it's recommended to use a more robust and scalable solution like AWS S3.

This guide will walk you through the process of configuring AWS S3 as your object storage backend for the Appcircle server. To use AWS S3 with Appcircle Server, you need to:

- Set up the necessary AWS credentials and permissions.
- Create the required AWS S3 buckets.
- Configure the Appcircle server to use AWS S3.

:::caution
AWS S3 configuration requires a fresh installation of Appcircle Server. If you have an existing installation with no data, you can uninstall and reinstall with AWS S3 configuration. However, migration from MinIO to AWS S3 is not supported for installations with existing data.
:::

## Prerequisites

Before you begin, ensure you have the following prerequisites:

- An AWS account with appropriate permissions to create and manage S3 buckets.
- The AWS CLI `2.x` **[installed](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)** and **[configured](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)** on your machine.
- The Helm chart **[installed](https://helm.sh/docs/intro/install/)** and **[configured](https://helm.sh/docs/intro/quickstart/)** for your Kubernetes cluster.
- Basic understanding of AWS IAM, S3, and Kubernetes concepts.

:::info
This guide assumes you have administrative access to your AWS account and Kubernetes cluster. If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.
:::

## Create and Configure AWS S3 buckets

### 1. Create the required AWS S3 buckets

To store the artifacts generated by the Appcircle server, you need to create the following S3 buckets.

:::info
The `spacetech` is a sample organization name to make bucket names unique since AWS S3 bucket names must be globally unique across all AWS accounts. You can use your own organization name instead of `spacetech`.
:::

- `${BUCKET_PREFIX}-temp`
- `${BUCKET_PREFIX}-build`
- `${BUCKET_PREFIX}-distribution`
- `${BUCKET_PREFIX}-storesubmit`
- `${BUCKET_PREFIX}-store`
- `${BUCKET_PREFIX}-agent-cache`
- `${BUCKET_PREFIX}-backup`
- `${BUCKET_PREFIX}-publish`

You can create the required S3 buckets using the AWS CLI with the following commands. Make sure you have configured your AWS credentials before running these commands.

```bash
# Set your organization name and region
ORG_NAME="spacetech" # Replace with your organization name
BUCKET_PREFIX="appcircle-${ORG_NAME}"
REGION="us-east-1" # Replace with your preferred AWS region

# Create all required buckets
aws s3 mb s3://${BUCKET_PREFIX}-temp --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-build --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-distribution --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-storesubmit --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-store --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-agent-cache --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-backup --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-publish --region ${REGION}
```

:::caution
- Replace `spacetech` with your organization name in the `ORG_NAME` variable
- Replace `us-east-1` with your preferred AWS region in the `REGION` variable
- Ensure your bucket names follow AWS S3 naming conventions:
  - 3-63 characters long
  - Lowercase letters, numbers, dots (.), and hyphens (-)
  - Must start and end with a letter or number
  - Must be DNS-compliant
:::

### 2. Configure CORS settings for the `temp` bucket

After creating the buckets, you should configure the CORS settings for the `temp` bucket to allow cross-origin requests from your Appcircle Server web UI.

:::caution
Replace `my.appcircle.spacetech.com` with your Appcircle Server web UI domain.
:::

```bash
aws s3api put-bucket-cors \
    --bucket ${BUCKET_PREFIX}-temp \
    --region ${REGION} \
    --cors-configuration '{
        "CORSRules": [
            {
                "AllowedHeaders": ["*"],
                "AllowedMethods": ["GET", "PUT", "POST", "DELETE", "HEAD"],
                "AllowedOrigins": ["https://my.appcircle.spacetech.com"],
                "ExposeHeaders": [],
                "MaxAgeSeconds": 3600
            }
        ]
    }'
```

:::tip
- The CORS configuration above is specific to the `temp` bucket. Other buckets don't require CORS configuration as they are accessed server-side.
:::

### 3. Configure an IAM user for Appcircle Server

Appcircle Server needs an IAM user with appropriate permissions to access the S3 buckets. Follow these steps to create and configure the IAM user:

- Set the IAM user name that will be used to access the S3 buckets:

```bash
IAM_USER="appcircle-server"
```

- Create an IAM user:
```bash
aws iam create-user --user-name ${IAM_USER}
```

- Create an IAM policy for S3 access. Run the following command to create a policy file named `appcircle-s3-policy.json`:

```bash
cat << 'EOF' > appcircle-s3-policy.json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket",
                "s3:GetBucketLocation"
            ],
            "Resource": [
                "arn:aws:s3:::${BUCKET_PREFIX}-temp",
                "arn:aws:s3:::${BUCKET_PREFIX}-temp/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-build",
                "arn:aws:s3:::${BUCKET_PREFIX}-build/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-distribution",
                "arn:aws:s3:::${BUCKET_PREFIX}-distribution/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-storesubmit",
                "arn:aws:s3:::${BUCKET_PREFIX}-storesubmit/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-store",
                "arn:aws:s3:::${BUCKET_PREFIX}-store/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-agent-cache",
                "arn:aws:s3:::${BUCKET_PREFIX}-agent-cache/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-backup",
                "arn:aws:s3:::${BUCKET_PREFIX}-backup/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-publish",
                "arn:aws:s3:::${BUCKET_PREFIX}-publish/*"
            ]
        }
    ]
}
EOF
```

- Create the IAM policy:
```bash
aws iam create-policy \
    --policy-name ${IAM_USER}-s3-policy \
    --policy-document file://appcircle-s3-policy.json
```

- Attach the policy to the IAM user:
```bash
aws iam attach-user-policy \
    --user-name ${IAM_USER} \
    --policy-arn arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):policy/${IAM_USER}-s3-policy
```

- Create access keys for the IAM user:
```bash
aws iam create-access-key --user-name ${IAM_USER}
```

- After creating the access keys, the output will look like this:

```json
{
    "AccessKey": {
        "UserName": "${IAM_USER}",
        "AccessKeyId": "AKIAXXXXXXXXXXXXXXXX",
        "Status": "Active",
        "SecretAccessKey": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
        "CreateDate": "2025-XX-XX"
    }
}
```

:::info
Save the access key ID and secret access key securely. You'll need these credentials to configure Appcircle Server to use AWS S3.
:::

## Create a secret with the AWS credentials

Create a Kubernetes secret with the AWS credentials to be used by Appcircle Server.

:::caution
- Replace `${ACCESS_KEY_ID}` and `${SECRET_ACCESS_KEY}` with the actual access key ID and secret access key.
- Replace `appcircle` with the actual namespace where Appcircle Server will be installed.
- **Do not replace** the `appcircle-server-minio-connection` secret name as it's required by the Helm chart.
:::

```bash
kubectl create secret generic appcircle-server-minio-connection \
  -n appcircle \
  --from-literal=accessKey=${ACCESS_KEY_ID}  \
  --from-literal=secretKey=${SECRET_ACCESS_KEY}
```

## Configure Appcircle Server to use AWS S3

**Before** deploying the Appcircle Server Helm chart, you need to configure the Helm chart with a `values.yaml` file that includes the AWS S3 configuration.

```yaml
global:
  minio:
    url: https://s3.us-east-1.amazonaws.com # Replace with your AWS S3 endpoint
    region: "us-east-1" # Replace with your AWS region
    useHttp: "false" # Set to "true" if you're using HTTP instead of HTTPS
resource:
  s3:
    clientProvider: "AWS" # Set to "AWS" to use AWS S3
    cdnProvider: ""
minio:
  enabled: false # Disable internal MinIO deployment
```

:::caution
- Replace `https://s3.us-east-1.amazonaws.com` with your [AWS S3 endpoint](https://docs.aws.amazon.com/general/latest/gr/s3.html).
- Replace `us-east-1` with your AWS region.
- Set `useHttp` to `true` only if you're using HTTP instead of HTTPS (not recommended for production).
:::


