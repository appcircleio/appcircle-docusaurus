---
title: AWS S3 Configuration
description: Learn how to configure AWS S3 as object storage for Appcircle server when installing using a Helm chart
tags:
  [
    self-hosted,
    aws,
    s3
]
sidebar_position: 40
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import NeedHelp from '@site/docs/\_need-help.mdx';

## Overview

This guide provides comprehensive instructions for configuring AWS S3 as your object storage backend for the Appcircle server. While the default Helm chart deployment includes MinIO as an in-cluster object storage solution, **production environments** benefit from using a more robust and scalable solution like AWS S3.

This guide will walk you through the process of configuring AWS S3 as your object storage backend for the Appcircle server. To use AWS S3 with Appcircle Server, you need to:

- Set up the necessary AWS credentials and permissions.
- Create the required AWS S3 buckets.
- Configure the Appcircle server to use AWS S3.

:::caution
AWS S3 configuration requires a **fresh installation** of Appcircle Server. If you have an existing installation with data, migration from MinIO to AWS S3 is **not supported**. You can only configure AWS S3 during the initial installation or if you have no existing data to preserve.
:::

## Prerequisites

To complete this guide, you must have the following:

### 1. AWS Account and Permissions

An **AWS account** with appropriate permissions to create and manage S3 buckets, IAM users, and policies.

<details>
    <summary>Click to view more details about AWS permissions.</summary>

You need the following AWS permissions to complete this configuration:

- **S3 permissions**: Create buckets, configure CORS, manage bucket policies
- **IAM permissions**: Create users, policies, and access keys
- **STS permissions**: Get caller identity (for policy attachment)

If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.

</details>

### 2. AWS CLI

The **AWS CLI version `2.x`** is **required** and must be **[installed](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)** and **[configured](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)** on your machine.

<details>
    <summary>Click to view more details about AWS CLI configuration.</summary>

To configure AWS CLI, you need:

- **Access Key ID** and **Secret Access Key** for your AWS account
- **Default region** for your AWS resources
- **Output format** (JSON is recommended)

You can configure AWS CLI using:
```bash
aws configure
```

Or by setting environment variables:
```bash
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_DEFAULT_REGION="us-east-1"
```

</details>

### 3. Kubernetes/OpenShift Access

**`kubectl`** (for Kubernetes) or **`oc`** (for OpenShift) CLI is **required** and must be configured to access your cluster.

### 4. Basic Understanding

Basic understanding of **AWS IAM**, **S3**, and **Kubernetes/OpenShift** concepts is recommended.

:::info
This guide assumes you have administrative access to your AWS account and Kubernetes/OpenShift cluster. If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.
:::

## Configuration Steps

### 1. Set Up Environment Variables

**Set up your environment variables** before proceeding with the configuration. These variables will be used throughout the configuration process.

:::note
In this documentation, we will use `spacetech` as an **example organization name** and `us-east-1` as an **example AWS region**. You should **replace these values** with your actual organization name and preferred AWS region.
:::

```bash
# Set your organization name and region
ORG_NAME="spacetech" # Replace with your organization name
BUCKET_PREFIX="appcircle-${ORG_NAME}-"
REGION="us-east-1" # Replace with your preferred AWS region
IAM_USER="appcircle-server"
```


### 2. Create AWS S3 Buckets

**Create the required S3 buckets** to store the artifacts generated by the Appcircle server.

Appcircle server requires the following S3 buckets for different purposes:

- **`${BUCKET_PREFIX}temp`**: Temporary files and uploads
- **`${BUCKET_PREFIX}build`**: Build artifacts and logs
- **`${BUCKET_PREFIX}distribution`**: Testing Distribution files
- **`${BUCKET_PREFIX}storesubmit`**: Appcircle Store Submit files
- **`${BUCKET_PREFIX}store`**: Enterprise App Store files
- **`${BUCKET_PREFIX}agent-cache`**: Appcircle Runner cache files
- **`${BUCKET_PREFIX}backup`**: Backup files
- **`${BUCKET_PREFIX}publish`**: Published mobile app binaries

Run the following commands to create all required buckets:

```bash
# Create all required buckets
aws s3 mb s3://${BUCKET_PREFIX}temp --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}build --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}distribution --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}storesubmit --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}store --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}agent-cache --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}backup --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}publish --region ${REGION}
```

:::info
The bucket names use your organization name to ensure global uniqueness, as AWS S3 bucket names must be unique across all AWS accounts worldwide.
:::

### 3. Configure CORS Settings

**Configure CORS settings** for the `temp` bucket to allow cross-origin requests from your Appcircle Server web UI.

:::caution
Replace the `https://my.appcircle.spacetech.com` with your actual Appcircle Server web UI URL.
:::

```bash
aws s3api put-bucket-cors \
    --bucket ${BUCKET_PREFIX}temp \
    --region ${REGION} \
    --cors-configuration '{
        "CORSRules": [
            {
                "AllowedHeaders": ["*"],
                "AllowedMethods": ["GET", "PUT", "POST", "DELETE", "HEAD"],
                "AllowedOrigins": ["https://my.appcircle.spacetech.com"],
                "ExposeHeaders": [],
                "MaxAgeSeconds": 3600
            }
        ]
    }'
```

:::tip
- The CORS configuration is only required for the `temp` bucket
- Other buckets don't require CORS configuration as they are accessed server-side
- If you're using HTTP instead of HTTPS, replace `https://` with `http://` in the AllowedOrigins
:::

### 4. Create IAM User and Policy

- **Create an IAM user** with appropriate permissions to access the S3 buckets.

```bash
aws iam create-user --user-name ${IAM_USER}
```

- **Create an IAM policy** that grants the necessary S3 permissions. Run the following command to create a policy file:

```bash
cat << EOF > appcircle-s3-policy.json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::${BUCKET_PREFIX}temp",
                "arn:aws:s3:::${BUCKET_PREFIX}temp/*",
                "arn:aws:s3:::${BUCKET_PREFIX}build",
                "arn:aws:s3:::${BUCKET_PREFIX}build/*",
                "arn:aws:s3:::${BUCKET_PREFIX}distribution",
                "arn:aws:s3:::${BUCKET_PREFIX}distribution/*",
                "arn:aws:s3:::${BUCKET_PREFIX}storesubmit",
                "arn:aws:s3:::${BUCKET_PREFIX}storesubmit/*",
                "arn:aws:s3:::${BUCKET_PREFIX}store",
                "arn:aws:s3:::${BUCKET_PREFIX}store/*",
                "arn:aws:s3:::${BUCKET_PREFIX}agent-cache",
                "arn:aws:s3:::${BUCKET_PREFIX}agent-cache/*",
                "arn:aws:s3:::${BUCKET_PREFIX}backup",
                "arn:aws:s3:::${BUCKET_PREFIX}backup/*",
                "arn:aws:s3:::${BUCKET_PREFIX}publish",
                "arn:aws:s3:::${BUCKET_PREFIX}publish/*"
            ]
        }
    ]
}
EOF
```

- **Create the IAM policy** for the IAM user.
```bash
aws iam create-policy \
    --policy-name ${IAM_USER}-s3-policy \
    --policy-document file://appcircle-s3-policy.json
```

- **Attach the policy to the IAM user**.

```bash
aws iam attach-user-policy \
    --user-name ${IAM_USER} \
    --policy-arn arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):policy/${IAM_USER}-s3-policy
```

### 5. Create Access Keys for the IAM User

- **Create access keys** for the IAM user to be used by Appcircle Server.

```bash
aws iam create-access-key --user-name ${IAM_USER}
```

- **Save the output** from the access key creation command. It will look like this:

```json
{
    "AccessKey": {
        "UserName": "appcircle-server",
        "AccessKeyId": "AKIAXXXXXXXXXXXXXXXX",
        "Status": "Active",
        "SecretAccessKey": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
        "CreateDate": "2025-XX-XX"
    }
}
```

:::warning
**Save the AccessKeyId and SecretAccessKey securely**. You'll need these credentials in the next step to create the Kubernetes secret.
:::

### 6. Optional: Create CloudFront CDN for AWS S3 Buckets

:::info
**What is CloudFront?**
CloudFront is AWS's Content Delivery Network (CDN) service that improves performance by caching your S3 content at edge locations worldwide. This reduces latency and improves download speeds for your users.

**Do you need CloudFront?**
- **For small teams or internal use**: Basic S3 configuration is sufficient
- **For production environments with global users**: CloudFront provides better performance
- **For high-traffic applications**: CloudFront reduces S3 costs and improves reliability
:::

```bash
openssl genrsa -out private_key.pem 2048
```

- Create public key for the CDN URL signing key.

```bash
openssl rsa -in private_key.pem -pubout -out public_key.pem
```

- Single line public key for the CDN URL signing key:

```bash
SINGLE_LINE_PUBLIC_KEY=$(awk '{printf "%s\\n", $0}' public_key.pem)
```

- Create public key configuration for the CDN URL signing key:

```bash
cat << EOF > public-key-config.json
{
    "CallerReference": "appcircle-cdn-sign-key",
    "Name": "appcircle-cdn-sign-key",
    "EncodedKey": "${SINGLE_LINE_PUBLIC_KEY}",
    "Comment": "appcircle cdn sign key"
}
EOF
```

- Create the public key:

```bash
aws cloudfront create-public-key \
    --public-key-config file://public-key-config.json
```

- Create key group configuration for the CDN URL signing key:

```bash
cat << EOF > key-group.json
{
  "Name": "appcircle-cdn-key-group",
  "Items": ["<Public Key ID From Previous Step>"]
}
EOF
```

- Convert the multi-line private key to a single line:

```bash
SINGLE_LINE_PRIVATE_KEY=$(cat private_key.pem | tr -d '\n')
```
- Create a secret for CDN URL signing key:

```bash
kubectl create secret generic appcircle-cdn-url-sign-key -n appcircle \
  --from-literal='cdn-url-sign-key-name=<Public Key ID From Previous Step>' \
  --from-literal="cdn-url-sign-key=${SINGLE_LINE_PRIVATE_KEY}"
```

- Create key group for the CDN URL signing key.

```bash
aws cloudfront create-key-group --key-group-config file://key-group.json
```

- Import SSL certificates for the CloudFront CDN domains.

:::caution
Do not replace the `us-east-1` region with your actual region. AWS requires the SSL certificate to be in the `us-east-1` region to be used with CloudFront.
:::

```bash
aws acm import-certificate --certificate fileb://cert.pem --certificate-chain fileb://fullchain.pem --private-key fileb://privkey.pem --region us-east-1
```

- Create a origin access control configuration for the S3 buckets:

```bash
cat << EOF > appcircle-oac-config.json
{
  "Name": "Appcircle-S3-OAC",
  "Description": "OAC for Appcircle S3 buckets",
  "SigningBehavior": "always",
  "SigningProtocol": "sigv4",
  "OriginAccessControlOriginType": "s3"
}
EOF
```

- Create the origin access control:

```bash
aws cloudfront create-origin-access-control \
  --origin-access-control-config file://appcircle-oac-config.json
```

- Create a CloudFront distribution configuration file:

```bash
cat << EOF > cloudfront-config.json
{
  "CallerReference": "appcircle-distribution-bucket-cdn",
  "Comment": "Appcircle Distribution Bucket CDN",
  "Aliases": {
    "Quantity": 1,
    "Items": [
      "appcircle-distribution-cdn.spacetech.com"
    ]
  },
  "ViewerCertificate": {
    "ACMCertificateArn": "<ACM Certificate ARN From Previous Step>",
    "SSLSupportMethod": "sni-only",
    "MinimumProtocolVersion": "TLSv1.2_2021",
    "CertificateSource": "acm"
  },
  "Enabled": true,
  "Origins": {
    "Items": [
      {
        "Id": "S3Origin",
        "DomainName": "appcircle-spacetech-distribution.s3.eu-central-1.amazonaws.com",
        "OriginAccessControlId": "<Origin Access Control ID From Previous Step>",
        "S3OriginConfig": {
          "OriginAccessIdentity": ""
        }
      }
    ],
    "Quantity": 1
  },
  "DefaultCacheBehavior": {
    "TargetOriginId": "S3Origin",
    "ViewerProtocolPolicy": "redirect-to-https",
    "TrustedKeyGroups": {
      "Enabled": true,
      "Quantity": 1,
      "Items": [
        "<Key Group ID From Previous Step>"
      ]
    },
    "AllowedMethods": {
      "Quantity": 2,
      "Items": [
        "GET",
        "HEAD"
      ],
      "CachedMethods": {
        "Quantity": 2,
        "Items": [
          "GET",
          "HEAD"
        ]
      }
    },
    "ForwardedValues": {
      "QueryString": false,
      "Cookies": {
        "Forward": "none"
      }
    },
    "MinTTL": 0,
    "DefaultTTL": 86400,
    "MaxTTL": 31536000
  }
}
EOF
```

:::caution
- Replace `<ACM Certificate ARN From Previous Step>` with the actual ACM certificate ARN from the previous step.
- Replace `<Origin Access Control ID From Previous Step>` with the actual origin access control ID from the previous step.
- Replace `<Key Group ID From Previous Step>` with the actual key group ID from the previous step.
- Replace `appcircle-spacetech-distribution.s3.eu-central-1.amazonaws.com` with your actual S3 bucket domain.
- Replace `appcircle-distribution-cdn.spacetech.com` with your actual CDN domain.
:::

- Create the CloudFront distribution:

```bash
aws cloudfront create-distribution --distribution-config file://cloudfront-config.json
```

- Create a DNS record on your domain provider to point to the CloudFront distribution.

- Create bucket policy for the S3 buckets:

```bash
cat << EOF > distribution-bucket-policy.json
{
  "Version": "2008-10-17",
  "Id": "PolicyForCloudFrontPrivateContent",
  "Statement": [
      {
          "Sid": "AllowCloudFrontServicePrincipal",
          "Effect": "Allow",
          "Principal": {
              "Service": "cloudfront.amazonaws.com"
          },
          "Action": "s3:GetObject",
          "Resource": "arn:aws:s3:::${BUCKET_PREFIX}distribution/*",
          "Condition": {
              "StringEquals": {
                "AWS:SourceArn": "<CloudFront Distribution ARN From Previous Step>"
              }
          }
      }
  ]
}
EOF
```

:::caution
- Replace `<CloudFront Distribution ARN>` with your actual CloudFront distribution ARN.
:::

- Apply the bucket policy to the S3 buckets:

```bash
aws s3api put-bucket-policy \
  --bucket ${BUCKET_PREFIX}distribution \
  --policy file://distribution-bucket-policy.json
```

- Repeat the same process for the other S3 buckets.

## Create Kubernetes Secret

**Create a Kubernetes secret** with the AWS credentials to be used by Appcircle Server.

<Tabs groupId="Platform">

  <TabItem value="kubernetes" label="Kubernetes">

```bash
kubectl create secret generic appcircle-server-minio-connection \
  -n appcircle \
  --from-literal=accessKey=<ACCESS_KEY_ID> \
  --from-literal=secretKey=<SECRET_ACCESS_KEY>
```

  </TabItem>
  <TabItem value="openshift" label="OpenShift">

```bash
oc create secret generic appcircle-server-minio-connection \
  -n appcircle \
  --from-literal=accessKey=${ACCESS_KEY_ID}  \
  --from-literal=secretKey=${SECRET_ACCESS_KEY}
```

  </TabItem>
</Tabs>

:::caution
- Replace `${ACCESS_KEY_ID}` and `${SECRET_ACCESS_KEY}` with the actual access key ID and secret access key from the [Create IAM User and Policy](#4-create-iam-user-and-policy) step.
- Replace `appcircle` with the actual namespace/project where Appcircle Server will be installed.
- **Do not replace** the `appcircle-server-minio-connection` secret name as it's required by the Helm chart.
:::

## Configure Helm Values

**Configure your `values.yaml` file** to use AWS S3 instead of MinIO.

Add the following configuration to your `values.yaml` file:

<Tabs groupId="cdn-enabled">

  <TabItem value="true" label="AWS CloudFront CDN Disabled">

```yaml
global:
  minio:
    url: https://s3.us-east-1.amazonaws.com # Replace with your AWS S3 endpoint
    region: "us-east-1" # Replace with your AWS region
    useHttp: "false" # Set to "false" if you're using HTTPS S3 endpoint
    bucketPrefix: "appcircle-spacetech-"
resource:
  s3:
    clientProvider: "AWS" # Set to "AWS" to use AWS S3
    cdnProvider: ""
minio:
  enabled: false # Disable internal MinIO deployment
```

:::caution
- Replace `https://s3.us-east-1.amazonaws.com` with your [AWS S3 endpoint](https://docs.aws.amazon.com/general/latest/gr/s3.html)
- Replace `us-east-1` with your AWS region
- Set `useHttp` to `true` only if you're using HTTP instead of HTTPS (not recommended for production)
- Replace `appcircle-spacetech-` with your actual bucket prefix
:::

  </TabItem>

  <TabItem value="false" label="AWS CloudFront CDN Enabled">

```yaml
global:
  minio:
    url: https://s3.us-east-1.amazonaws.com # Replace with your AWS S3 endpoint
    region: "us-east-1" # Replace with your AWS region
    useHttp: "false" # Set to "false" if you're using HTTPS S3 endpoint
    bucketPrefix: "appcircle-spacetech-"
resource:
  s3:
    clientProvider: "AWS" # Set to "AWS" to use AWS S3
    cdnProvider: "AWS" # Set to "AWS" to use AWS CloudFront CDN
    urlSignKeySecretName: "appcircle-cdn-url-sign-key" # Set to the secret name of the CDN URL signing key
    cdnMapping: "Build=https://appcircle-build-cdn.spacetech.com,Distribution=https://appcircle-distribution-cdn.spacetech.com,Storesubmit=https://appcircle-storesubmit-cdn.spacetech.com,Store=https://appcircle-store-cdn.spacetech.com,Publish=https://appcircle-publish-cdn.spacetech.com" # Replace with your CDN mapping
    urlSignPolicy: "{'Statement':[{'Resource':'%RESOURCE%','Condition':{'DateGreaterThan': {'AWS:EpochTime': %START_TIME%},'DateLessThan':{'AWS:EpochTime':%END_TIME%}}}]}" # You don't need to change this value if there are no specific requirements.
minio:
  enabled: false # Disable internal MinIO deployment  
```

:::caution
- Replace `https://s3.us-east-1.amazonaws.com` with your [AWS S3 endpoint](https://docs.aws.amazon.com/general/latest/gr/s3.html)
- Replace `us-east-1` with your AWS region
- Set `useHttp` to `true` only if you're using HTTP instead of HTTPS (not recommended for production)
- Replace `appcircle-spacetech-` with your actual bucket prefix
- Replace `appcircle-build-cdn.spacetech.com` with your actual `build` bucket CDN domain
- Replace `appcircle-distribution-cdn.spacetech.com` with your actual `distribution` bucket CDN domain
- Replace `appcircle-storesubmit-cdn.spacetech.com` with your actual `storesubmit` bucket CDN domain
- Replace `appcircle-store-cdn.spacetech.com` with your actual `store` bucket CDN domain
- Replace `appcircle-publish-cdn.spacetech.com` with your actual `publish` bucket CDN domain
:::

  </TabItem>
</Tabs>





## Next Steps

After completing the AWS S3 configuration:

1. **Return to the main installation guide**:
   - For Kubernetes: [Kubernetes Installation](/self-hosted-appcircle/install-server/helm-chart/installation/kubernetes)
   - For OpenShift: [OpenShift Installation](/self-hosted-appcircle/install-server/helm-chart/installation/openshift)

2. **Continue with the installation process** using your configured `values.yaml` file

3. **Verify the configuration** by checking that Appcircle Server can access the S3 buckets after installation

<NeedHelp />


