---
title: AWS S3 Configuration
description: Learn how to configure AWS S3 as object storage for Appcircle server when installing using a Helm chart
tags:
  [
    self-hosted,
    aws,
    s3
]
sidebar_position: 40
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import NeedHelp from '@site/docs/\_need-help.mdx';

## Overview

This guide provides comprehensive instructions for configuring AWS S3 as your object storage backend for the Appcircle server. While the default Helm chart deployment includes MinIO as an in-cluster object storage solution, **production environments** benefit from using a more robust and scalable solution like AWS S3.

This guide will walk you through the process of configuring AWS S3 as your object storage backend for the Appcircle server. To use AWS S3 with Appcircle Server, you need to:

- Set up the necessary AWS credentials and permissions.
- Create the required AWS S3 buckets.
- Configure the Appcircle server to use AWS S3.

:::caution
AWS S3 configuration requires a **fresh installation** of Appcircle Server. If you have an existing installation with data, migration from MinIO to AWS S3 is **not supported**. You can only configure AWS S3 during the initial installation or if you have no existing data to preserve.
:::

## Prerequisites

To complete this guide, you must have the following:

### 1. AWS Account and Permissions

An **AWS account** with appropriate permissions to create and manage S3 buckets, IAM users, and policies.

<details>
    <summary>Click to view more details about AWS permissions.</summary>

You need the following AWS permissions to complete this configuration:

- **S3 permissions**: Create buckets, configure CORS, manage bucket policies
- **IAM permissions**: Create users, policies, and access keys
- **STS permissions**: Get caller identity (for policy attachment)

If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.

</details>

### 2. AWS CLI

The **AWS CLI version `2.x`** is **required** and must be **[installed](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)** and **[configured](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)** on your machine.

<details>
    <summary>Click to view more details about AWS CLI configuration.</summary>

To configure AWS CLI, you need:

- **Access Key ID** and **Secret Access Key** for your AWS account
- **Default region** for your AWS resources
- **Output format** (JSON is recommended)

You can configure AWS CLI using:
```bash
aws configure
```

Or by setting environment variables:
```bash
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_DEFAULT_REGION="us-east-1"
```

</details>

### 3. Kubernetes/OpenShift Access

**`kubectl`** (for Kubernetes) or **`oc`** (for OpenShift) CLI is **required** and must be configured to access your cluster.

### 4. Basic Understanding

Basic understanding of **AWS IAM**, **S3**, and **Kubernetes/OpenShift** concepts is recommended.

:::info
This guide assumes you have administrative access to your AWS account and Kubernetes/OpenShift cluster. If you're working in a restricted environment, ensure you have the necessary permissions before proceeding.
:::

## Configuration Steps

### 1. Set Up Environment Variables

**Set up your environment variables** before proceeding with the configuration. These variables will be used throughout the configuration process.

:::note
In this documentation, we will use `spacetech` as an **example organization name** and `us-east-1` as an **example AWS region**. You should **replace these values** with your actual organization name and preferred AWS region.
:::

```bash
# Set your organization name and region
ORG_NAME="spacetech" # Replace with your organization name
BUCKET_PREFIX="appcircle-${ORG_NAME}"
REGION="us-east-1" # Replace with your preferred AWS region
IAM_USER="appcircle-server"
```


### 2. Create AWS S3 Buckets

**Create the required S3 buckets** to store the artifacts generated by the Appcircle server.

Appcircle server requires the following S3 buckets for different purposes:

- **`${BUCKET_PREFIX}-temp`**: Temporary files and uploads
- **`${BUCKET_PREFIX}-build`**: Build artifacts and logs
- **`${BUCKET_PREFIX}-distribution`**: Testing Distribution files
- **`${BUCKET_PREFIX}-storesubmit`**: Appcircle Store Submit files
- **`${BUCKET_PREFIX}-store`**: Enterprise App Store files
- **`${BUCKET_PREFIX}-agent-cache`**: Appcircle Runner cache files
- **`${BUCKET_PREFIX}-backup`**: Backup files
- **`${BUCKET_PREFIX}-publish`**: Published mobile app binaries

Run the following commands to create all required buckets:

```bash
# Create all required buckets
aws s3 mb s3://${BUCKET_PREFIX}-temp --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-build --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-distribution --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-storesubmit --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-store --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-agent-cache --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-backup --region ${REGION}
aws s3 mb s3://${BUCKET_PREFIX}-publish --region ${REGION}
```

:::info
The bucket names use your organization name to ensure global uniqueness, as AWS S3 bucket names must be unique across all AWS accounts worldwide.
:::

### 3. Configure CORS Settings

**Configure CORS settings** for the `temp` bucket to allow cross-origin requests from your Appcircle Server web UI.

:::caution
Replace the `https://my.appcircle.spacetech.com` with your actual Appcircle Server web UI URL.
:::

```bash
aws s3api put-bucket-cors \
    --bucket ${BUCKET_PREFIX}-temp \
    --region ${REGION} \
    --cors-configuration '{
        "CORSRules": [
            {
                "AllowedHeaders": ["*"],
                "AllowedMethods": ["GET", "PUT", "POST", "DELETE", "HEAD"],
                "AllowedOrigins": ["https://my.appcircle.spacetech.com"],
                "ExposeHeaders": [],
                "MaxAgeSeconds": 3600
            }
        ]
    }'
```

:::tip
- The CORS configuration is only required for the `temp` bucket
- Other buckets don't require CORS configuration as they are accessed server-side
- If you're using HTTP instead of HTTPS, replace `https://` with `http://` in the AllowedOrigins
:::

### 4. Create IAM User and Policy

- **Create an IAM user** with appropriate permissions to access the S3 buckets.

```bash
aws iam create-user --user-name ${IAM_USER}
```

- **Create an IAM policy** that grants the necessary S3 permissions. Run the following command to create a policy file:

```bash
cat << 'EOF' > appcircle-s3-policy.json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::${BUCKET_PREFIX}-temp",
                "arn:aws:s3:::${BUCKET_PREFIX}-temp/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-build",
                "arn:aws:s3:::${BUCKET_PREFIX}-build/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-distribution",
                "arn:aws:s3:::${BUCKET_PREFIX}-distribution/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-storesubmit",
                "arn:aws:s3:::${BUCKET_PREFIX}-storesubmit/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-store",
                "arn:aws:s3:::${BUCKET_PREFIX}-store/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-agent-cache",
                "arn:aws:s3:::${BUCKET_PREFIX}-agent-cache/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-backup",
                "arn:aws:s3:::${BUCKET_PREFIX}-backup/*",
                "arn:aws:s3:::${BUCKET_PREFIX}-publish",
                "arn:aws:s3:::${BUCKET_PREFIX}-publish/*"
            ]
        }
    ]
}
EOF
```

- **Create the IAM policy** for the IAM user.
```bash
aws iam create-policy \
    --policy-name ${IAM_USER}-s3-policy \
    --policy-document file://appcircle-s3-policy.json
```

- **Attach the policy to the IAM user**.

```bash
aws iam attach-user-policy \
    --user-name ${IAM_USER} \
    --policy-arn arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):policy/${IAM_USER}-s3-policy
```

### 5. Create Access Keys for the IAM User

- **Create access keys** for the IAM user to be used by Appcircle Server.

```bash
aws iam create-access-key --user-name ${IAM_USER}
```

- **Save the output** from the access key creation command. It will look like this:

```json
{
    "AccessKey": {
        "UserName": "appcircle-server",
        "AccessKeyId": "AKIAXXXXXXXXXXXXXXXX",
        "Status": "Active",
        "SecretAccessKey": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
        "CreateDate": "2025-XX-XX"
    }
}
```

:::warning
**Save the AccessKeyId and SecretAccessKey securely**. You'll need these credentials in the next step to create the Kubernetes secret.
:::

## Create Kubernetes Secret

**Create a Kubernetes secret** with the AWS credentials to be used by Appcircle Server.

<Tabs groupId="Platform">

  <TabItem value="kubernetes" label="Kubernetes">

```bash
kubectl create secret generic appcircle-server-minio-connection \
  -n appcircle \
  --from-literal=accessKey=<ACCESS_KEY_ID> \
  --from-literal=secretKey=<SECRET_ACCESS_KEY>
```

  </TabItem>
  <TabItem value="openshift" label="OpenShift">

```bash
oc create secret generic appcircle-server-minio-connection \
  -n appcircle \
  --from-literal=accessKey=${ACCESS_KEY_ID}  \
  --from-literal=secretKey=${SECRET_ACCESS_KEY}
```

  </TabItem>
</Tabs>

:::caution
- Replace `${ACCESS_KEY_ID}` and `${SECRET_ACCESS_KEY}` with the actual access key ID and secret access key from the [Create IAM User and Policy](#4-create-iam-user-and-policy) step.
- Replace `appcircle` with the actual namespace/project where Appcircle Server will be installed.
- **Do not replace** the `appcircle-server-minio-connection` secret name as it's required by the Helm chart.
:::

## Configure Helm Values

**Configure your `values.yaml` file** to use AWS S3 instead of MinIO.

Add the following configuration to your `values.yaml` file:

```yaml
global:
  minio:
    url: https://s3.us-east-1.amazonaws.com # Replace with your AWS S3 endpoint
    region: "us-east-1" # Replace with your AWS region
    useHttp: "false" # Set to "false" if you're using HTTPS S3 endpoint
resource:
  s3:
    clientProvider: "AWS" # Set to "AWS" to use AWS S3
    cdnProvider: ""
minio:
  enabled: false # Disable internal MinIO deployment
```

:::caution
- Replace `https://s3.us-east-1.amazonaws.com` with your [AWS S3 endpoint](https://docs.aws.amazon.com/general/latest/gr/s3.html)
- Replace `us-east-1` with your AWS region
- Set `useHttp` to `true` only if you're using HTTP instead of HTTPS (not recommended for production)
:::

## Next Steps

After completing the AWS S3 configuration:

1. **Return to the main installation guide**:
   - For Kubernetes: [Kubernetes Installation](/self-hosted-appcircle/install-server/helm-chart/installation/kubernetes)
   - For OpenShift: [OpenShift Installation](/self-hosted-appcircle/install-server/helm-chart/installation/openshift)

2. **Continue with the installation process** using your configured `values.yaml` file

3. **Verify the configuration** by checking that Appcircle Server can access the S3 buckets after installation

<NeedHelp />


